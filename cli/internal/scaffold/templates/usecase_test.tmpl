package usecase_test

import (
    "errors"
    "testing"

    "{{ .ImportPath }}/internal/domain/entity"
    "{{ .ImportPath }}/internal/domain/usecase"
)

type fakeRepo struct {
    saveFn   func(*entity.{{ .EntityName }}) error
    findFn   func(string) (*entity.{{ .EntityName }}, error)
    deleteFn func(string) error
}

func (f *fakeRepo) Save(e *entity.{{ .EntityName }}) error {
    if f.saveFn != nil {
        return f.saveFn(e)
    }
    return nil
}

func (f *fakeRepo) FindByID(id string) (*entity.{{ .EntityName }}, error) {
    if f.findFn != nil {
        return f.findFn(id)
    }
    return nil, nil
}

func (f *fakeRepo) Delete(id string) error {
    if f.deleteFn != nil {
        return f.deleteFn(id)
    }
    return nil
}

func Test{{ .EntityName }}UseCase_Create(t *testing.T) {
    t.Run("success", func(t *testing.T) {
        repo := &fakeRepo{saveFn: func(e *entity.{{ .EntityName }}) error { return nil }}
        uc := usecase.New{{ .EntityName }}UseCase(repo)

        err := uc.Create(&entity.{{ .EntityName }}{})
        if err != nil {
            t.Errorf("expected nil, got %v", err)
        }
    })

    t.Run("failure", func(t *testing.T) {
        repo := &fakeRepo{saveFn: func(e *entity.{{ .EntityName }}) error {
            return errors.New("fail")
        }}
        uc := usecase.New{{ .EntityName }}UseCase(repo)

        err := uc.Create(&entity.{{ .EntityName }}{})
        if err == nil {
            t.Errorf("expected error, got nil")
        }
    })
}
